<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<style>
.container {
  width: 600px;
}
</style>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>
<div class="container">     
<div style='background-color:navy;font-size:150%;color:white;position:relative;'>
  자바85기^^

  <div style='position:absolute;right:0px;top:0px;font-size:15px;'>
    <a href='/webapp01/auth/form.do'
       class="btn btn-success btn-xs">로그인</a></div> 

</div>


<h1>게시물 목록조회2</h1>
<p><button type="button" class="btn btn-primary btn-sm" 
           onclick="location.href='boardForm.html'">새 글</button></p>

<table id="boardTable" class="table table-hover">
<thead>
<tr>
  <th>번호</th>
  <th>제목</th>
  <th>등록일</th>
  <th>조회수</th>
</tr>
</thead>
<tbody></tbody>
</table>
      
<p style='background-color:yellow; text-align:center;'>
  이 예제는 자바85기에서 사용한 것입니다.2</p>
</div>

<script>

loadTable()

function loadTable() {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function(result) {
    if (xhr.readyState != 4)
      return;
    
    if (xhr.status != 200) {
      alert("서버에 잘못 요청했습니다.")
      return;
    }
    
    var result = JSON.parse(xhr.responseText)
    
    if (result.state != "success") {
    	alert("서버에서 데이터를 가져오는데 실패하였습니다.")
    	return
    }
    
    var contents = ""
    var arr = result.data
    for (var i in arr) {
    	contents += "<tr>" +
    	  "<td>" + arr[i].no + "</td>" + 
    	  "<td><a class='titleLink' href='#' data-no='" + arr[i].no + "'>" + arr[i].title + "</a></td>" +
    	  "<td>" + arr[i].createdDate + "</td>" +
    	  "<td>" + arr[i].viewCount + "</td>" + 
    	  "</tr>"
    }
    
    document.querySelector("#boardTable tbody").innerHTML = contents;
    
    // tr 태그를 추가한 후에 제목에 대해 click 리스너를 추가한다.
    var aTags = document.querySelectorAll(".titleLink")
    for (var i = 0; i < aTags.length; i++) {
	    aTags[i].onclick = function(event) {
	    	//alert(this.getAttribute("data-no")) // 태그 고유의 프로퍼티가 아니기 때문에 getAttribute() 사용
	    	window.location.href = "boardForm.html?no=" + this.getAttribute("data-no")
	    }
    }
  }
  xhr.open("GET", "list.json", true)
  //xhr.open("GET", "test.jsp", true)
  //xhr.open("GET", "test.txt", true)
  xhr.send() 
}

</script>


</body>
</html>




